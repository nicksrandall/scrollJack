{"version":3,"file":"scrollJack.m.js","sources":["../src/scrollJack.js"],"sourcesContent":["const getViewPortSize = () => ({\n  top: 0,\n  left: 0,\n  width:\n    window.innerWidth ||\n    document.documentElement.clientWidth ||\n    document.body.clientWidth,\n  height:\n    window.innerHeight ||\n    document.documentElement.clientHeight ||\n    document.body.clientHeight\n});\n\nconst scrollTop = element => {\n  if (element === document.body) {\n    return (\n      window.pageYOffset ||\n      document.documentElement.scrollTop ||\n      document.body.scrollTop\n    );\n  }\n  return element.scrollTop;\n};\n\nconst scrollLeft = element => {\n  if (element === document.body) {\n    return (\n      window.pageXOffset ||\n      document.documentElement.scrollLeft ||\n      document.body.scrollLeft\n    );\n  }\n  return element.scrollLeft;\n};\n\n// TODO: support offsets\nclass ScrollJack {\n  constructor(element = document.body) {\n    this.element = element;\n    this.registry = Object.create(null);\n    this.bbMap = new Map();\n    this.raf = null;\n    this.timeout = null;\n    this.lastScrollY = 0;\n    this.lastScrollX = 0;\n\n    console.log(\"element\", this.element);\n\n    this.viewport =\n      this.element === document.body\n        ? getViewPortSize()\n        : element.getBoundingClientRect();\n\n    this.handler = this.handler.bind(this);\n    this.resize = this.resize.bind(this);\n    this.inView = this.inView.bind(this);\n    this.aboveView = this.aboveView.bind(this);\n    this.belowView = this.belowView.bind(this);\n    this.leftOfView = this.leftOfView.bind(this);\n    this.rightOfView = this.rightOfView.bind(this);\n\n    if (this.element === document.body) {\n      window.addEventListener(\"scroll\", this.handler, {\n        capture: false,\n        passive: true\n      });\n    } else {\n      this.element.addEventListener(\"scroll\", this.handler, {\n        capture: false,\n        passive: true\n      });\n    }\n\n    window.addEventListener(\"resize\", this.resize, {\n      capture: false,\n      passive: true\n    });\n  }\n  on(name, handler) {\n    (this.registry[name] || (this.registry[name] = [])).push(handler);\n    return this;\n  }\n  off(name, handler) {\n    if (this.registry[name]) {\n      this.registryl[name].splice(\n        this.registry[name].indexOf(handler) >>> 0,\n        1\n      );\n    }\n    return this;\n  }\n  trigger(name, props) {\n    (this.registry[name] || []).slice().map(handler => {\n      handler(props);\n    });\n    return this;\n  }\n  resize() {\n    if (this.timeout) {\n      window.clearTimeout(timeout);\n    }\n    this.timeout = window.setTimeout(() => {\n      this.viewport =\n        element === document.body\n          ? getViewPortSize()\n          : element.getClientBoundingRect();\n    }, 16);\n  }\n  destory() {\n    if (this.element === document.body) {\n      window.removeEventListener(\"scroll\", this.handler);\n    } else {\n      this.element.removeEventListener(\"scroll\", this.handler);\n    }\n\n    window.removeEventListener(\"resize\", this.resize);\n  }\n  getClientBoundingRect(element) {\n    let br;\n    if (this.bbMap.has(element)) {\n      br = this.bbMap.get(element);\n    } else {\n      br = element.getBoundingClientRect();\n      this.bbMap.set(element, br);\n    }\n    return br;\n  }\n  // TODO Add offset for container element if not window\n  inView(element) {\n    const br = this.getClientBoundingRect(element);\n    return (\n      br.top - this.viewport.top > -1 * br.height &&\n      br.top - this.viewport.top < this.viewport.height &&\n      br.left - this.viewport.left > -1 * br.width &&\n      br.left - this.viewport.left < this.viewport.width\n    );\n  }\n  // TODO Add offset for container element if not window\n  aboveView(element) {\n    const br = this.getClientBoundingRect(element);\n    return (\n      br.top - this.viewport.top < 0 &&\n      -1 * (br.top - this.viewport.top) > br.height\n    );\n  }\n  // TODO Add offset for container element if not window\n  belowView(element) {\n    const br = this.getClientBoundingRect(element);\n    return br.top - this.viewport.top > this.viewport.height;\n  }\n  leftOfView(element) {\n    const br = this.getClientBoundingRect(element);\n    return (\n      br.left - this.viewport.left < 0 &&\n      -1 * (br.left - this.viewport.left) > br.width\n    );\n  }\n  rightOfView(element) {\n    const br = this.getClientBoundingRect(element);\n    return br.left - this.viewport.left > this.viewport.width;\n  }\n  handler(event) {\n    if (this.raf) {\n      window.cancelAnimationFrame(this.raf);\n    }\n    this.raf = window.requestAnimationFrame(() => {\n      const props = {\n        event,\n        inView: this.inView,\n        aboveView: this.aboveView,\n        belowView: this.belowView,\n        leftOfView: this.leftOfView,\n        rightOfView: this.rightOfView\n      };\n      props.scrollPositionY = scrollTop(this.element);\n      props.scrollPositionX = scrollLeft(this.element);\n\n      // vertical\n      if (props.scrollPositionY > this.lastScrollY) {\n        props.goingDown = true;\n        props.goingUp = false;\n        props.vertical = true;\n      } else if (props.scrollPositionY < this.lastScrollY) {\n        props.goingDown = false;\n        props.goingUp = true;\n        props.vertical = true;\n      } else {\n        props.goingDown = false;\n        props.goingUp = false;\n        props.vertical = false;\n      }\n      // horizontal\n      if (props.scrollPositionX > this.lastScrollX) {\n        props.goingRight = true;\n        props.goingLeft = false;\n        props.horizontal = true;\n      } else if (props.scrollPositionX < this.lastScrollX) {\n        props.goingRight = false;\n        props.goingLeft = true;\n        props.horizontal = true;\n      } else {\n        props.goingRight = false;\n        props.goingLeft = false;\n        props.horizontal = false;\n      }\n\n      props.deltaY = props.scrollPositionY - this.lastScrollY;\n      props.deltaX = props.scrollPositionX - this.lastScrollX;\n\n      this.lastScrollY = props.scrollPositionY;\n      this.lastScrollX = props.scrollPositionX;\n\n      // all scrolls\n      this.trigger(ScrollJack.SCROLL, props);\n\n      // vertical scrolls\n      props.goingUp && this.trigger(ScrollJack.SCROLL_UP, props);\n      props.goingDown && this.trigger(ScrollJack.SCROLL_DOWN, props);\n      props.vertical && this.trigger(ScrollJack.SCROLL_VERTICAL, props);\n\n      // // horizontal scrolls\n      props.goingLeft && this.trigger(ScrollJack.SCROLL_LEFT, props);\n      props.goingRight && this.trigger(ScrollJack.SCROLL_RIGHT, props);\n      props.horizontal && this.trigger(ScrollJack.SCROLL_HORIZONTAL, props);\n\n      this.bbMap.clear();\n    });\n  }\n}\n\nScrollJack.SCROLL = \"SCROLL\";\nScrollJack.SCROLL_VERTICAL = \"SCROLL_VERTICAL\";\nScrollJack.SCROLL_UP = \"SCROLL_UP\";\nScrollJack.SCROLL_DOWN = \"SCROLL_DOWN\";\nScrollJack.SCROLL_HORIZONTAL = \"SCROLL_HORIZONTRAL\";\nScrollJack.SCROLL_LEFT = \"SCROLL_LEFT\";\nScrollJack.SCROLL_RIGHT = \"SCROLL_RIGHT\";\n\nexport default ScrollJack;\n"],"names":["const","getViewPortSize","top","left","width","window","innerWidth","document","documentElement","clientWidth","body","height","innerHeight","clientHeight","ScrollJack","element","registry","Object","create","bbMap","Map","raf","timeout","lastScrollY","lastScrollX","log","this","viewport","getBoundingClientRect","handler","bind","resize","inView","aboveView","belowView","leftOfView","rightOfView","addEventListener","on","name","push","off","registryl","splice","indexOf","trigger","props","slice","map","clearTimeout","setTimeout","getClientBoundingRect","destory","removeEventListener","br","has","get","set","event","cancelAnimationFrame","requestAnimationFrame","scrollPositionY","pageYOffset","scrollTop","scrollPositionX","pageXOffset","scrollLeft","goingDown","goingUp","vertical","goingRight","goingLeft","horizontal","deltaY","deltaX","SCROLL","SCROLL_UP","SCROLL_DOWN","SCROLL_VERTICAL","SCROLL_LEFT","SCROLL_RIGHT","SCROLL_HORIZONTAL","clear"],"mappings":"AAAAA,IAAMC,oBACJC,IAAK,EACLC,KAAM,EACNC,MACEC,OAAOC,YACPC,SAASC,gBAAgBC,aACzBF,SAASG,KAAKD,YAChBE,OACEN,OAAOO,aACPL,SAASC,gBAAgBK,cACzBN,SAASG,KAAKG,eA0BZC,EACJ,SAAYC,kBAAUR,SAASG,WACxBK,QAAUA,OACVC,SAAWC,OAAOC,OAAO,WACzBC,MAAQ,IAAIC,SACZC,IAAM,UACNC,QAAU,UACVC,YAAc,OACdC,YAAc,UAEXC,IAAI,UAAWC,KAAKX,cAEvBY,SACHD,KAAKX,UAAYR,SAASG,KACtBT,IACAc,EAAQa,6BAETC,QAAUH,KAAKG,QAAQC,KAAKJ,WAC5BK,OAASL,KAAKK,OAAOD,KAAKJ,WAC1BM,OAASN,KAAKM,OAAOF,KAAKJ,WAC1BO,UAAYP,KAAKO,UAAUH,KAAKJ,WAChCQ,UAAYR,KAAKQ,UAAUJ,KAAKJ,WAChCS,WAAaT,KAAKS,WAAWL,KAAKJ,WAClCU,YAAcV,KAAKU,YAAYN,KAAKJ,MAErCA,KAAKX,UAAYR,SAASG,YACrB2B,iBAAiB,SAAUX,KAAKG,kBAC5B,WACA,SAGNd,QAAQsB,iBAAiB,SAAUX,KAAKG,kBAClC,WACA,WAINQ,iBAAiB,SAAUX,KAAKK,iBAC5B,WACA,iBAGbO,YAAGC,EAAMV,UACNH,KAAKV,SAASuB,KAAUb,KAAKV,SAASuB,QAAaC,KAAKX,GAClDH,kBAETe,aAAIF,EAAMV,UACJH,KAAKV,SAASuB,SACXG,UAAUH,GAAMI,OACnBjB,KAAKV,SAASuB,GAAMK,QAAQf,KAAa,EACzC,GAGGH,kBAETmB,iBAAQN,EAAMO,UACXpB,KAAKV,SAASuB,QAAaQ,QAAQC,aAAInB,KAC9BiB,KAEHpB,kBAETK,6BACML,KAAKJ,gBACA2B,aAAa3B,cAEjBA,QAAUjB,OAAO6C,wBACfvB,SACHZ,UAAYR,SAASG,KACjBT,IACAc,QAAQoC,yBACb,iBAELC,mBACM1B,KAAKX,UAAYR,SAASG,YACrB2C,oBAAoB,SAAU3B,KAAKG,cAErCd,QAAQsC,oBAAoB,SAAU3B,KAAKG,gBAG3CwB,oBAAoB,SAAU3B,KAAKK,qBAE5CoB,+BAAsBpC,OAChBuC,SACA5B,KAAKP,MAAMoC,IAAIxC,KACZW,KAAKP,MAAMqC,IAAIzC,MAEfA,EAAQa,6BACRT,MAAMsC,IAAI1C,EAASuC,IAEnBA,eAGTtB,gBAAOjB,OACCuC,EAAK5B,KAAKyB,sBAAsBpC,UAEpCuC,EAAGpD,IAAMwB,KAAKC,SAASzB,KAAO,EAAIoD,EAAG3C,QACrC2C,EAAGpD,IAAMwB,KAAKC,SAASzB,IAAMwB,KAAKC,SAAShB,QAC3C2C,EAAGnD,KAAOuB,KAAKC,SAASxB,MAAQ,EAAImD,EAAGlD,OACvCkD,EAAGnD,KAAOuB,KAAKC,SAASxB,KAAOuB,KAAKC,SAASvB,mBAIjD6B,mBAAUlB,OACFuC,EAAK5B,KAAKyB,sBAAsBpC,UAEpCuC,EAAGpD,IAAMwB,KAAKC,SAASzB,IAAM,IAC5B,GAAKoD,EAAGpD,IAAMwB,KAAKC,SAASzB,KAAOoD,EAAG3C,oBAI3CuB,mBAAUnB,UACGW,KAAKyB,sBAAsBpC,GAC5Bb,IAAMwB,KAAKC,SAASzB,IAAMwB,KAAKC,SAAShB,oBAEpDwB,oBAAWpB,OACHuC,EAAK5B,KAAKyB,sBAAsBpC,UAEpCuC,EAAGnD,KAAOuB,KAAKC,SAASxB,KAAO,IAC9B,GAAKmD,EAAGnD,KAAOuB,KAAKC,SAASxB,MAAQmD,EAAGlD,mBAG7CgC,qBAAYrB,UACCW,KAAKyB,sBAAsBpC,GAC5BZ,KAAOuB,KAAKC,SAASxB,KAAOuB,KAAKC,SAASvB,mBAEtDyB,iBAAQ6B,cACFhC,KAAKL,YACAsC,qBAAqBjC,KAAKL,UAE9BA,IAAMhB,OAAOuD,qCAxJJ7C,EAyJN+B,SACJY,SACQhC,EAAKM,iBACFN,EAAKO,oBACLP,EAAKQ,qBACJR,EAAKS,uBACJT,EAAKU,eAEdyB,iBAjKM9C,EAiKsBW,EAAKX,WAhK3BR,SAASG,KAErBL,OAAOyD,aACPvD,SAASC,gBAAgBuD,WACzBxD,SAASG,KAAKqD,UAGXhD,EAAQgD,YA0JLC,yBAvJOjD,GACjB,OAAIA,IAAYR,SAASG,KAErBL,OAAO4D,aACP1D,SAASC,gBAAgB0D,YACzB3D,SAASG,KAAKwD,WAGXnD,EAAQmD,WA+IaA,CAAWxC,EAAKX,SAGpC+B,EAAMe,gBAAkBnC,EAAKH,eACzB4C,WAAY,IACZC,SAAU,IACVC,UAAW,GACRvB,EAAMe,gBAAkBnC,EAAKH,eAChC4C,WAAY,IACZC,SAAU,IACVC,UAAW,MAEXF,WAAY,IACZC,SAAU,IACVC,UAAW,GAGfvB,EAAMkB,gBAAkBtC,EAAKF,eACzB8C,YAAa,IACbC,WAAY,IACZC,YAAa,GACV1B,EAAMkB,gBAAkBtC,EAAKF,eAChC8C,YAAa,IACbC,WAAY,IACZC,YAAa,MAEbF,YAAa,IACbC,WAAY,IACZC,YAAa,KAGfC,OAAS3B,EAAMe,gBAAkBnC,EAAKH,cACtCmD,OAAS5B,EAAMkB,gBAAkBtC,EAAKF,cAEvCD,YAAcuB,EAAMe,kBACpBrC,YAAcsB,EAAMkB,kBAGpBnB,QAAQ/B,EAAW6D,OAAQ7B,KAG1BsB,SAAW1C,EAAKmB,QAAQ/B,EAAW8D,UAAW9B,KAC9CqB,WAAazC,EAAKmB,QAAQ/B,EAAW+D,YAAa/B,KAClDuB,UAAY3C,EAAKmB,QAAQ/B,EAAWgE,gBAAiBhC,KAGrDyB,WAAa7C,EAAKmB,QAAQ/B,EAAWiE,YAAajC,KAClDwB,YAAc5C,EAAKmB,QAAQ/B,EAAWkE,aAAclC,KACpD0B,YAAc9C,EAAKmB,QAAQ/B,EAAWmE,kBAAmBnC,KAE1D3B,MAAM+D,WAKjBpE,EAAW6D,OAAS,SACpB7D,EAAWgE,gBAAkB,kBAC7BhE,EAAW8D,UAAY,YACvB9D,EAAW+D,YAAc,cACzB/D,EAAWmE,kBAAoB,qBAC/BnE,EAAWiE,YAAc,cACzBjE,EAAWkE,aAAe"}