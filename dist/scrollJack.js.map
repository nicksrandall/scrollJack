{"version":3,"file":"scrollJack.js","sources":["../src/scrollJack.js"],"sourcesContent":["const getViewPortSize = () => ({\n  top: 0,\n  left: 0,\n  width:\n    window.innerWidth ||\n    document.documentElement.clientWidth ||\n    document.body.clientWidth,\n  height:\n    window.innerHeight ||\n    document.documentElement.clientHeight ||\n    document.body.clientHeight\n});\n\nconst scrollTop = element => {\n  if (element === document.body) {\n    return (\n      window.pageYOffset ||\n      document.documentElement.scrollTop ||\n      document.body.scrollTop\n    );\n  }\n  return element.scrollTop;\n};\n\nconst scrollLeft = element => {\n  if (element === document.body) {\n    return (\n      window.pageXOffset ||\n      document.documentElement.scrollLeft ||\n      document.body.scrollLeft\n    );\n  }\n  return element.scrollLeft;\n};\n\n// TODO: support offsets\nclass ScrollJack {\n  constructor(element = document.body) {\n    this.element = element;\n    this.registry = Object.create(null);\n    this.bbMap = new Map();\n    this.raf = null;\n    this.timeout = null;\n    this.lastScrollY = 0;\n    this.lastScrollX = 0;\n\n    this.viewport =\n      this.element === document.body\n        ? getViewPortSize()\n        : element.getBoundingClientRect();\n\n    this.handler = this.handler.bind(this);\n    this.resize = this.resize.bind(this);\n    this.inView = this.inView.bind(this);\n    this.aboveView = this.aboveView.bind(this);\n    this.belowView = this.belowView.bind(this);\n    this.leftOfView = this.leftOfView.bind(this);\n    this.rightOfView = this.rightOfView.bind(this);\n    this.atTop = this.atTop.bind(this);\n    this.atLeft = this.atLeft.bind(this);\n    this.atBottom = this.atBottom.bind(this);\n    this.atRight = this.atRight.bind(this);\n    this.getBoundingClientRect = this.getBoundingClientRect.bind(this);\n\n    this.makeProps(null);\n\n    if (this.element === document.body) {\n      window.addEventListener(\"scroll\", this.handler, {\n        capture: false,\n        passive: true\n      });\n    } else {\n      this.element.addEventListener(\"scroll\", this.handler, {\n        capture: false,\n        passive: true\n      });\n    }\n\n    window.addEventListener(\"resize\", this.resize, {\n      capture: false,\n      passive: true\n    });\n  }\n  on(name, handler) {\n    (this.registry[name] || (this.registry[name] = [])).push(handler);\n    return this;\n  }\n  off(name, handler) {\n    if (this.registry[name]) {\n      this.registryl[name].splice(\n        this.registry[name].indexOf(handler) >>> 0,\n        1\n      );\n    }\n    return this;\n  }\n  trigger(name, ) {\n    (this.registry[name] || []).slice().map(handler => {\n      handler(this.props);\n    });\n    return this;\n  }\n  resize() {\n    if (this.timeout) {\n      window.clearTimeout(this.timeout);\n    }\n    this.timeout = window.setTimeout(() => {\n      this.viewport =\n        this.element === document.body\n          ? getViewPortSize()\n          : this.element.getBoundingClientRect();\n    }, 16);\n  }\n  destory() {\n    if (this.element === document.body) {\n      window.removeEventListener(\"scroll\", this.handler);\n    } else {\n      this.element.removeEventListener(\"scroll\", this.handler);\n    }\n\n    window.removeEventListener(\"resize\", this.resize);\n  }\n  getBoundingClientRect(element) {\n    let br;\n    if (this.bbMap.has(element)) {\n      br = this.bbMap.get(element);\n    } else {\n      br = element.getBoundingClientRect();\n      this.bbMap.set(element, br);\n    }\n    return br;\n  }\n  // TODO Add offset for container element if not window\n  inView(element) {\n    const br = this.getBoundingClientRect(element);\n    return (\n      br.top - this.viewport.top > -1 * br.height &&\n      br.top - this.viewport.top < this.viewport.height &&\n      br.left - this.viewport.left > -1 * br.width &&\n      br.left - this.viewport.left < this.viewport.width\n    );\n  }\n  // TODO Add offset for container element if not window\n  aboveView(element) {\n    const br = this.getBoundingClientRect(element);\n    return -1 * (br.top - this.viewport.top) > br.height;\n  }\n  // TODO Add offset for container element if not window\n  belowView(element) {\n    const br = this.getBoundingClientRect(element);\n    return br.top - this.viewport.top > this.viewport.height;\n  }\n  leftOfView(element) {\n    const br = this.getBoundingClientRect(element);\n    return -1 * (br.left - this.viewport.left) > br.width;\n  }\n  rightOfView(element) {\n    const br = this.getBoundingClientRect(element);\n    return br.left - this.viewport.left > this.viewport.width;\n  }\n  atTop(element) {\n    const br = this.getBoundingClientRect(element);\n    return (\n      br.top - this.viewport.top <= 0 &&\n      -1 * (br.top - this.viewport.top) < br.height\n    );\n  }\n  atBottom(element) {\n    const br = this.getBoundingClientRect(element);\n    return (br.top - this.viewport.top + br.height) >= this.viewport.height\n  }\n  atLeft(element) {\n    const br = this.getBoundingClientRect(element);\n    return (\n      br.left - this.viewport.left <= 0 &&\n      -1 * (br.left - this.viewport.left) < br.width\n    );\n  }\n  atRight(element) {\n    const br = this.getBoundingClientRect(element);\n    return (br.left - this.viewport.left + br.width) >= this.viewport.width\n  }\n  makeProps(event) {\n    if (this.props) {\n      return this.props;\n    }\n    const props = {\n      event,\n      viewport: this.viewport,\n      getBoundingClientRect: this.getBoundingClientRect,\n      inView: this.inView,\n      aboveView: this.aboveView,\n      belowView: this.belowView,\n      leftOfView: this.leftOfView,\n      rightOfView: this.rightOfView,\n      atTop: this.atTop,\n      atBottom: this.atBottom,\n      atLeft: this.atLeft,\n      atRight: this.atRight,\n    };\n    props.scrollPositionY = scrollTop(this.element);\n    props.scrollPositionX = scrollLeft(this.element);\n\n    // vertical\n    if (props.scrollPositionY > this.lastScrollY) {\n      props.goingDown = true;\n      props.goingUp = false;\n      props.vertical = true;\n    } else if (props.scrollPositionY < this.lastScrollY) {\n      props.goingDown = false;\n      props.goingUp = true;\n      props.vertical = true;\n    } else {\n      props.goingDown = false;\n      props.goingUp = false;\n      props.vertical = false;\n    }\n    // horizontal\n    if (props.scrollPositionX > this.lastScrollX) {\n      props.goingRight = true;\n      props.goingLeft = false;\n      props.horizontal = true;\n    } else if (props.scrollPositionX < this.lastScrollX) {\n      props.goingRight = false;\n      props.goingLeft = true;\n      props.horizontal = true;\n    } else {\n      props.goingRight = false;\n      props.goingLeft = false;\n      props.horizontal = false;\n    }\n\n    props.deltaY = props.scrollPositionY - this.lastScrollY;\n    props.deltaX = props.scrollPositionX - this.lastScrollX;\n\n    this.lastScrollY = props.scrollPositionY;\n    this.lastScrollX = props.scrollPositionX;\n\n    this.props = props;\n    return this.props;\n  }\n  handler(event) {\n    if (this.raf) {\n      window.cancelAnimationFrame(this.raf);\n    }\n    this.raf = window.requestAnimationFrame(() => {\n      this.bbMap.clear();\n      this.props = null;\n      this.makeProps(event);\n\n      // all scrolls\n      this.trigger(ScrollJack.SCROLL);\n\n      // vertical scrolls\n      this.props.goingUp && this.trigger(ScrollJack.SCROLL_UP);\n      this.props.goingDown && this.trigger(ScrollJack.SCROLL_DOWN);\n      this.props.vertical && this.trigger(ScrollJack.SCROLL_VERTICAL);\n\n      // // horizontal scrolls\n      this.props.goingLeft && this.trigger(ScrollJack.SCROLL_LEFT);\n      this.props.goingRight && this.trigger(ScrollJack.SCROLL_RIGHT);\n      this.props.horizontal && this.trigger(ScrollJack.SCROLL_HORIZONTAL);\n    });\n  }\n}\n\nScrollJack.SCROLL = \"SCROLL\";\nScrollJack.SCROLL_VERTICAL = \"SCROLL_VERTICAL\";\nScrollJack.SCROLL_UP = \"SCROLL_UP\";\nScrollJack.SCROLL_DOWN = \"SCROLL_DOWN\";\nScrollJack.SCROLL_HORIZONTAL = \"SCROLL_HORIZONTRAL\";\nScrollJack.SCROLL_LEFT = \"SCROLL_LEFT\";\nScrollJack.SCROLL_RIGHT = \"SCROLL_RIGHT\";\n\nexport default ScrollJack;\n"],"names":["const","getViewPortSize","top","left","width","window","innerWidth","document","documentElement","clientWidth","body","height","innerHeight","clientHeight","ScrollJack","element","registry","Object","create","bbMap","Map","raf","timeout","lastScrollY","lastScrollX","viewport","this","getBoundingClientRect","handler","bind","resize","inView","aboveView","belowView","leftOfView","rightOfView","atTop","atLeft","atBottom","atRight","makeProps","addEventListener","on","name","push","off","registryl","splice","indexOf","trigger","slice","map","props","clearTimeout","setTimeout","destory","removeEventListener","br","has","get","set","event","scrollPositionY","pageYOffset","scrollTop","scrollPositionX","pageXOffset","scrollLeft","goingDown","goingUp","vertical","goingRight","goingLeft","horizontal","deltaY","deltaX","cancelAnimationFrame","requestAnimationFrame","clear","SCROLL","SCROLL_UP","SCROLL_DOWN","SCROLL_VERTICAL","SCROLL_LEFT","SCROLL_RIGHT","SCROLL_HORIZONTAL"],"mappings":"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"}