{"version":3,"file":"scrollJack.js","sources":["../src/scrollJack.js"],"sourcesContent":["export const events = {\n  SCROLL: 'scroll',\n  SCROLL_VERTICAL: 'scroll-vertical',\n  SCROLL_UP: 'scroll-up',\n  SCROLL_DOWN: 'scroll-down',\n  SCROLL_HORIZONTRAL: 'scroll-horizontal',\n  SCROLL_LEFT: 'scroll-left',\n  SCROLL_RIGHT: 'scroll-right'\n};\n\nclass ClearableWeakMap {\n  constructor(init) {\n    this._wm = new WeakMap(init);\n  }\n  clear() {\n    this._wm = new WeakMap();\n  }\n  delete(k) {\n    return this._wm.delete(k);\n  }\n  get(k) {\n    return this._wm.get(k);\n  }\n  has(k) {\n    return this._wm.has(k);\n  }\n  set(k, v) {\n    this._wm.set(k, v);\n    return this;\n  }\n}\n\nexport const getViewPortSize = () => {\n  const w = window,\n    d = document,\n    e = d.documentElement,\n    g = d.getElementsByTagName('body')[0],\n    width = w.innerWidth || e.clientWidth || g.clientWidth,\n    height = w.innerHeight || e.clientHeight || g.clientHeight;\n  return { width, height };\n};\n\nexport const scrollTop = () =>\n  document.documentElement.scrollTop || document.body.scrollTop;\n\nexport const scrollLeft = () =>\n  document.documentElement.scrollLeft || document.body.scrollLeft;\n\nexport class ScrollJack {\n  constructor() {\n    this.events = events;\n    this.registry = {};\n    this.raf = null;\n    this.lastScrollY = 0;\n    this.lastScrollX = 0;\n\n    this.bbMap = new ClearableWeakMap();\n    this.viewport = getViewPortSize();\n\n    this._handler = this._handler.bind(this);\n    this.inView = this.inView.bind(this);\n    this.aboveView = this.aboveView.bind(this);\n    this.belowView = this.belowView.bind(this);\n\n    window.addEventListener('scroll', this._handler, false);\n\n    let timeout = null;\n    window.addEventListener(\n      'resize',\n      () => {\n        if (timeout) {\n          window.clearTimeout(timeout);\n        }\n        timeout = window.setTimeout(() => {\n          this.viewport = getViewPortSize();\n        }, 16);\n      },\n      false\n    );\n  }\n  on(name, handler) {\n    (this.registry[name] || (this.registry[name] = [])).push(handler);\n    return this;\n  }\n  off(name, handler) {\n    if (this.registry[name]) {\n      this.registryl[name].splice(\n        this.registry[name].indexOf(handler) >>> 0,\n        1\n      );\n    }\n    return this;\n  }\n  trigger(name, props) {\n    (this.registry[name] || []).slice().map(handler => {\n      handler(props);\n    });\n    return this;\n  }\n  getClientBoundingRect(element) {\n    let br;\n    if (this.bbMap.has(element)) {\n      br = this.bbMap.get(element);\n    } else {\n      br = element.getBoundingClientRect();\n      this.bbMap.set(element, br);\n    }\n    return br;\n  }\n  inView(element) {\n    const br = this.getClientBoundingRect(element);\n    return br.top > -1 * br.height;\n  }\n  aboveView(element) {\n    const br = this.getClientBoundingRect(element);\n    return br.top < 0;\n  }\n  belowView(element) {\n    const br = this.getClientBoundingRect(element);\n    return br.top > this.viewport.height;\n  }\n  _handler(event) {\n    if (this.raf) {\n      window.cancelAnimationFrame(this.raf);\n    }\n    this.raf = window.requestAnimationFrame(() => {\n      const props = {\n        event,\n        inView: this.inView,\n        aboveView: this.aboveView,\n        belowView: this.belowView\n      };\n      props.scrollPositionY = scrollTop();\n      props.scrollPositionX = scrollLeft();\n\n      // vertical\n      if (props.scrollPositionY > this.lastScrollY) {\n        props.goingDown = true;\n        props.goingUp = false;\n        props.vertical = true;\n      } else if (props.scrollPositionY < this.lastScrollY) {\n        props.goingDown = false;\n        props.goingUp = true;\n        props.vertical = true;\n      } else {\n        props.goingDown = false;\n        props.goingUp = false;\n        props.vertical = false;\n      }\n      // horizontal\n      if (props.scrollPositionX > this.lastScrollX) {\n        props.goingRight = true;\n        props.goingLeft = false;\n        props.horizontal = true;\n      } else if (props.scrollPositionX < this.lastScrollX) {\n        props.goingRight = false;\n        props.goingLeft = true;\n        props.horizontal = true;\n      } else {\n        props.goingRight = false;\n        props.goingLeft = false;\n        props.horizontal = false;\n      }\n\n      props.deltaY = props.scrollPositionY - this.lastScrollY;\n      props.deltaX = props.scrollPositionX - this.lastScrollX;\n\n      this.lastScrollY = props.scrollPositionY;\n      this.lastScrollX = props.scrollPositionX;\n\n      // all scrolls\n      this.trigger(events.SCROLL, props);\n\n      // vertical scrolls\n      props.goingUp && this.trigger(events.SCROLL_UP, props);\n      props.goingDown && this.trigger(events.SCROLL_DOWN, props);\n      props.vertical && this.trigger(events.SCROLL_VERTICAL, props);\n\n      // // horizontal scrolls\n      props.goingLeft && this.trigger(events.SCROLL_LEFT, props);\n      props.goingRight && this.trigger(events.SCROLL_RIGHT, props);\n      props.horizontal && this.trigger(events.SCROLL_HORIZONTAL, props);\n\n      this.bbMap.clear();\n    });\n  }\n}\n\nexport default new ScrollJack();\n"],"names":["const","events","SCROLL","SCROLL_VERTICAL","SCROLL_UP","SCROLL_DOWN","SCROLL_HORIZONTRAL","SCROLL_LEFT","SCROLL_RIGHT","ClearableWeakMap","init","_wm","WeakMap","clear","delete","k","this","get","has","set","v","getViewPortSize","w","window","d","document","e","documentElement","g","getElementsByTagName","innerWidth","clientWidth","innerHeight","clientHeight","ScrollJack","registry","raf","lastScrollY","lastScrollX","bbMap","viewport","_handler","bind","inView","aboveView","belowView","addEventListener","timeout","clearTimeout","setTimeout","on","name","handler","push","off","registryl","splice","indexOf","trigger","props","slice","map","getClientBoundingRect","element","br","getBoundingClientRect","top","height","event","cancelAnimationFrame","requestAnimationFrame","scrollPositionY","scrollTop","body","scrollPositionX","scrollLeft","goingDown","goingUp","vertical","goingRight","goingLeft","horizontal","deltaY","deltaX","SCROLL_HORIZONTAL"],"mappings":"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"}